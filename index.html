<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium PDF Tools Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.18.0/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
/* --- Basic Reset & Fonts --- */
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Roboto', sans-serif;}
body { background:#f2f3f7; color:#333; display:flex; min-height:100vh; }
/* --- Sidebar --- */
#sidebar { width:250px; background:#1f1f2e; color:#fff; display:flex; flex-direction:column; transition:0.3s; position:fixed; height:100%; overflow:auto; z-index:1000; }
#sidebar h2 { text-align:center; margin:20px 0; font-weight:700; color:#f0a500; }
#sidebar button { background:none; border:none; color:#fff; text-align:left; padding:15px 20px; font-size:16px; cursor:pointer; transition:0.2s; }
#sidebar button:hover { background:#2f2f4a; }
#sidebar.active { left:0; }
/* --- Main Content --- */
#content { flex:1; margin-left:250px; padding:20px; transition:0.3s; }
#menuToggle { display:none; position:fixed; top:10px; left:10px; background:#f0a500; border:none; color:#1f1f2e; padding:10px 15px; cursor:pointer; font-weight:700; z-index:1100; border-radius:5px; }
/* --- Preview Container --- */
.preview-container { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
.preview-item { position:relative; background:#fff; padding:5px; border-radius:5px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; }
.preview-item img { max-width:120px; max-height:120px; display:block; margin-bottom:5px; border-radius:3px; }
.preview-item select, .preview-item button { margin-top:5px; font-size:12px; padding:3px; }
/* Remove button */
.remove-btn { position:absolute; top:2px; right:2px; background:#f44336; color:#fff; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer; }
/* Input and buttons */
input, select, button { margin-top:10px; padding:8px; border-radius:5px; border:1px solid #ccc; outline:none; font-size:14px; }
button { background:#f0a500; color:#1f1f2e; border:none; cursor:pointer; font-weight:700; transition:0.2s; }
button:hover { background:#d18b00; }
/* Mobile */
@media(max-width:768px){ #sidebar{ position:fixed; left:-250px; } #menuToggle{ display:block; } #content{ margin-left:0; } }
</style>
</head>
<body>

<button id="menuToggle">Menu</button>

<div id="sidebar">
<h2>PDF Tools Hub</h2>
<button onclick="showTool('imagepdf')">Image → PDF</button>
<button onclick="showTool('mergepdf')">Merge PDFs</button>
<button onclick="showTool('splitpdf')">Split PDF</button>
<button onclick="showTool('compresspdf')">Compress PDF</button>
<button onclick="showTool('watermark')">Add Watermark</button>
<button onclick="showTool('protectpdf')">Protect / Unlock PDF</button>
</div>

<div id="content">
<h1>Welcome to Premium PDF Tools Hub</h1>
<p>Select a tool from the menu to start working on your PDFs.</p>
</div>

<script>
const sidebar=document.getElementById('sidebar');
const content=document.getElementById('content');
const menuToggle=document.getElementById('menuToggle');

menuToggle.onclick=()=>{ sidebar.style.left=(sidebar.style.left==='0px'?'-250px':'0px'); }

document.addEventListener('click', e=>{ if(!sidebar.contains(e.target)&&e.target!==menuToggle){ sidebar.style.left='-250px'; } });

let images=[]; // For Image → PDF

// --- Show tool based on selection ---
function showTool(tool){
  content.innerHTML=''; // clear content
  switch(tool){
    case 'imagepdf': renderImagePDF(); break;
    case 'mergepdf': renderMergePDF(); break;
    case 'splitpdf': renderSplitPDF(); break;
    case 'compresspdf': renderCompressPDF(); break;
    case 'watermark': renderWatermarkPDF(); break;
    case 'protectpdf': renderProtectPDF(); break;
  }
}

// ---------- IMAGE → PDF ----------
function renderImagePDF(){
  content.innerHTML=`
  <h1>Image → PDF</h1>
  <input type="file" id="imageInput" multiple accept="image/*"><br>
  <input type="text" id="filenameInput" placeholder="Enter output filename"><br>
  <div id="preview" class="preview-container"></div>
  <button onclick="generatePDF()">Generate PDF</button>
  `;
  images=[];
  document.getElementById('imageInput').addEventListener('change', e=>{
    Array.from(e.target.files).forEach(f=> images.push({src:URL.createObjectURL(f), mode:'color'}));
    renderPreviews();
  });
  suggestFilename();
}

function renderPreviews(){
  const preview=document.getElementById('preview');
  preview.innerHTML='';
  images.forEach((imgObj,index)=>{
    const div=document.createElement('div'); div.className='preview-item';
    const img=document.createElement('img'); img.src=imgObj.src;
    const removeBtn=document.createElement('button'); removeBtn.className='remove-btn'; removeBtn.textContent='×';
    removeBtn.onclick=()=>{ images.splice(index,1); renderPreviews(); }
    const select=document.createElement('select');
    select.innerHTML=`<option value="color">Original</option><option value="bw">Black & White</option>`;
    select.value=imgObj.mode;
    select.onchange=e=>{ images[index].mode=e.target.value; }
    div.appendChild(img); div.appendChild(removeBtn); div.appendChild(select);
    preview.appendChild(div);
  });
}

// Suggest default filename
function suggestFilename(){
  const now=new Date();
  const defaultName=`PDF_${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}-${String(now.getMinutes()).padStart(2,'0')}.pdf`;
  const input=document.getElementById('filenameInput'); if(input) input.value=defaultName;
}

// Sanitize filename
function sanitizeFilename(name){ return name.replace(/[\\/:*?"<>|]/g,''); }

// Convert image with mode
function processImage(imageObj,callback){
  const img=new Image();
  img.onload=()=>{
    const canvas=document.createElement('canvas'); canvas.width=img.width; canvas.height=img.height;
    const ctx=canvas.getContext('2d'); ctx.drawImage(img,0,0);
    if(imageObj.mode==='bw'){
      const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
      const data=imgData.data;
      for(let i=0;i<data.length;i+=4){ const avg=(data[i]+data[i+1]+data[i+2])/3; data[i]=data[i+1]=data[i+2]=avg; }
      ctx.putImageData(imgData,0,0);
    }
    callback(canvas.toDataURL('image/jpeg'));
  }
  img.src=imageObj.src;
}

async function generatePDF(){
  if(images.length===0){ alert("Add at least one image."); return; }
  const { jsPDF } = window.jspdf;
  const pdf=new jsPDF();
  let processedCount=0;
  images.forEach((imgObj,i)=>{
    processImage(imgObj, processedSrc=>{
      if(i>0) pdf.addPage();
      pdf.addImage(processedSrc,'JPEG',10,10,190,277);
      processedCount++;
      if(processedCount===images.length){
        let filename=document.getElementById('filenameInput').value.trim();
        filename=sanitizeFilename(filename); if(!filename) filename='output.pdf';
        if(!filename.toLowerCase().endsWith('.pdf')) filename+='.pdf';
        pdf.save(filename);
      }
    });
  });
}

// ---------- MERGE PDFs ----------
function renderMergePDF(){
  content.innerHTML=`
  <h1>Merge PDFs</h1>
  <input type="file" id="mergeFiles" multiple accept="application/pdf"><br>
  <input type="text" id="mergeFilename" placeholder="Enter output filename"><br>
  <button onclick="mergePDFs()">Merge PDFs</button>
  `;
}

async function mergePDFs(){
  const files=document.getElementById('mergeFiles').files;
  if(files.length<2){ alert("Select at least 2 PDFs."); return; }
  const pdfDoc = await PDFLib.PDFDocument.create();
  for(const f of files){
    const arrayBuffer=await f.arrayBuffer();
    const donorDoc=await PDFLib.PDFDocument.load(arrayBuffer);
    const copiedPages = await pdfDoc.copyPages(donorDoc, donorDoc.getPageIndices());
    copiedPages.forEach(p=>pdfDoc.addPage(p));
  }
  const pdfBytes=await pdfDoc.save();
  let filename=document.getElementById('mergeFilename').value.trim();
  if(!filename) filename='merged.pdf';
  if(!filename.toLowerCase().endsWith('.pdf')) filename+='.pdf';
  const blob=new Blob([pdfBytes],{type:'application/pdf'});
  const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download=filename; link.click();
}

// ---------- SPLIT PDF ----------
function renderSplitPDF(){
  content.innerHTML=`
  <h1>Split PDF</h1>
  <input type="file" id="splitFile" accept="application/pdf"><br>
  <input type="text" id="splitFilename" placeholder="Enter output filename"><br>
  <input type="text" id="splitPages" placeholder="Pages to extract (e.g., 1,3-5)"><br>
  <button onclick="splitPDF()">Split PDF</button>
  `;
}

async function splitPDF(){
  const file=document.getElementById('splitFile').files[0];
  if(!file){ alert("Select a PDF."); return; }
  const arrayBuffer=await file.arrayBuffer();
  const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
  const pagesInput=document.getElementById('splitPages').value.trim();
  let pagesToExtract=[];
  pagesInput.split(',').forEach(r=>{
    if(r.includes('-')){
      const [start,end]=r.split('-').map(n=>parseInt(n)-1);
      for(let i=start;i<=end;i++) pagesToExtract.push(i);
    }else{ pagesToExtract.push(parseInt(r)-1); }
  });
  if(pagesToExtract.length===0){ alert("No pages selected"); return; }
  const newPdf = await PDFLib.PDFDocument.create();
  const copied=await newPdf.copyPages(pdfDoc,pagesToExtract);
  copied.forEach(p=>newPdf.addPage(p));
  const pdfBytes=await newPdf.save();
  let filename=document.getElementById('splitFilename').value.trim();
  if(!filename) filename='split.pdf';
  if(!filename.toLowerCase().endsWith('.pdf')) filename+='.pdf';
  const blob=new Blob([pdfBytes],{type:'application/pdf'});
  const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download=filename; link.click();
}

// ---------- COMPRESS PDF ----------
function renderCompressPDF(){
  content.innerHTML=`
  <h1>Compress PDF</h1>
  <input type="file" id="compressFile" accept="application/pdf"><br>
  <input type="text" id="compressFilename" placeholder="Enter output filename"><br>
  <button onclick="compressPDF()">Compress PDF</button>
  <p>Compression reduces image quality for smaller file size.</p>
  `;
}

async function compressPDF(){
  const file=document.getElementById('compressFile').files[0];
  if(!file){ alert("Select PDF"); return; }
  const arrayBuffer=await file.arrayBuffer();
  const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
  // Simply resave to compress (basic)
  const pdfBytes = await pdfDoc.save({useObjectStreams:true});
  let filename=document.getElementById('compressFilename').value.trim();
  if(!filename) filename='compressed.pdf';
  if(!filename.toLowerCase().endsWith('.pdf')) filename+='.pdf';
  const blob=new Blob([pdfBytes],{type:'application/pdf'});
  const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download=filename; link.click();
}

// ---------- WATERMARK PDF ----------
function renderWatermarkPDF(){
  content.innerHTML=`
  <h1>Add Watermark</h1>
  <input type="file" id="watermarkFile" accept="application/pdf"><br>
  <input type="text" id="watermarkText" placeholder="Enter watermark text"><br>
  <input type="text" id="watermarkFilename" placeholder="Enter output filename"><br>
  <button onclick="addWatermark()">Add Watermark</button>
  `;
}

async function addWatermark(){
  const file=document.getElementById('watermarkFile').files[0];
  const text=document.getElementById('watermarkText').value.trim();
  if(!file||!text){ alert("Select file and enter text"); return; }
  const arrayBuffer=await file.arrayBuffer();
  const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
  const pages = pdfDoc.getPages();
  pages.forEach(p=>{
    const { width, height } = p.getSize();
    p.drawText(text, { x:width/4, y:height/2, size:50, opacity:0.3, rotate:PDFLib.degrees(-45) });
  });
  const pdfBytes = await pdfDoc.save();
  let filename=document.getElementById('watermarkFilename').value.trim();
  if(!filename) filename='watermarked.pdf';
  if(!filename.toLowerCase().endsWith('.pdf')) filename+='.pdf';
  const blob=new Blob([pdfBytes],{type:'application/pdf'});
  const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download=filename; link.click();
}

// ---------- PROTECT / UNLOCK PDF ----------
function renderProtectPDF(){
  content.innerHTML=`
  <h1>Protect / Unlock PDF</h1>
  <input type="file" id="protectFile" accept="application/pdf"><br>
  <input type="text" id="pdfPassword" placeholder="Enter password"><br>
  <input type="text" id="protectFilename" placeholder="Enter output filename"><br>
  <button onclick="protectPDF()">Encrypt PDF</button>
  <button onclick="unlockPDF()">Decrypt PDF</button>
  `;
}

window.protectPDF=async function(){
  const file=document.getElementById('protectFile').files[0];
  const pwd=document.getElementById('pdfPassword').value.trim();
  const filenameInput=document.getElementById('protectFilename');
  if(!file||!pwd){ alert("Select PDF and enter password"); return; }
  const arrayBuffer=await file.arrayBuffer();
  const wordArray=CryptoJS.lib.WordArray.create(arrayBuffer);
  const encrypted=CryptoJS.AES.encrypt(wordArray,pwd).toString();
  const blob=new Blob([encrypted],{type:"text/plain"});
  let name=filenameInput.value.trim() || "encrypted.pdf";
  if(!name.toLowerCase().endsWith('.pdf')) name+=".pdf";
  const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download=name; link.click();
}

window.unlockPDF=async function(){
  const file=document.getElementById('protectFile').files[0];
  const pwd=document.getElementById('pdfPassword').value.trim();
  const filenameInput=document.getElementById('protectFilename');
  if(!file||!pwd){ alert("Select file and enter password"); return; }
  const text=await file.text();
  try{
    const decrypted=CryptoJS.AES.decrypt(text,pwd);
    const typedArray=Uint8Array.from(decrypted.words.flatMap(word=>[(word>>24)&0xFF,(word>>16)&0xFF,(word>>8)&0xFF,word&0xFF])).slice(0,decrypted.sigBytes);
    const blob=new Blob([typedArray],{type:"application/pdf"});
    let name=filenameInput.value.trim() || "decrypted.pdf";
    if(!name.toLowerCase().endsWith('.pdf')) name+=".pdf";
    const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download=name; link.click();
  } catch(e){ alert("Incorrect password or invalid file!"); }
}
</script>

</body>
</html>
